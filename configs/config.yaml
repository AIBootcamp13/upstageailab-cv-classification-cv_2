# Main Hydra configuration file
# Fixed WandB integration + enhanced experiment tracking

defaults:
  - _self_
  - experiment: default
  - model: resnet50
  - optimizer: adamw
  - scheduler: cosine_warm_restart
  - data: document
  - override hydra/hydra_logging: disabled
  - override hydra/job_logging: disabled

# Global settings
seed: 42
device: 'cuda'

# ðŸ”¥ FIXED: WandB Configuration - Now properly enabled
wandb:
  enabled: true  # ðŸ”§ Changed from false to true
  project: "document-classifier"
  entity: null
  username: wchoi189
  tags: ["document-classification", "resnet50"]  # ðŸ”§ Updated tags
  notes: "augmentation on retry"  # ðŸ”§ Updated notes
  
  # ðŸ”§ Enhanced logging settings
  
  log_frequency: 10
  log_images: true
  log_model: false  # ðŸ”§ Changed to true for model artifacts
  log_gradients: false
  log_confusion_matrix: true
  
  # Advanced features
  watch_model: true
  log_code: true

# Paths configuration (unchanged)
paths:
  output_dir: "outputs"
  prediction_dir: "predictions"
  model_dir: "models"
  batch_dir: "batch"
  batch_summary_filename: "batch_summary.csv"

# Training configuration (unchanged)
train:
  epochs: 30
  batch_size: 32
  mixed_precision: true
  
  # Early stopping
  early_stopping:
    patience: 8
    metric: 'val_f1'
    mode: 'max'

# ðŸ”§ ENHANCED: Data configuration with improved augmentation reporting
data:
  root_dir: "data/raw"
  csv_file: "data/raw/metadata/train.csv"
  meta_file: "data/raw/metadata/meta.csv"
  image_size: 224
  val_size: 0.2
  num_workers: 0
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  use_document_augmentation: true
  # ðŸ”§ FIXED: Augmentation Configuration - Better structure
  augmentation:
    strategy: "robust"  # Options: "basic", "document", "robust"
    intensity: 0.9  # 0.0 = minimal, 1.0 = maximum
       # ðŸ”§ Added explicit enabled flag
    
    # Detailed settings for better WandB logging
    geometric:     
      intensity: 0.6
      perspective_scale: [0.05, 0.15]
      rotation_limit: 15
      
    lighting:     
      intensity: 0.7
      brightness_contrast_limit: 0.3
      shadow_probability: 0.5
      gamma_range: [70, 130]
      
    quality:     
      intensity: 0.5
      blur_limit: 7
      noise_probability: 0.3
      compression_probability: 0.3

    # Advanced options
    advanced:
      # Test Time Augmentation (for inference)
      tta_enabled: false
      tta_transforms: ["horizontal_flip", "rotation"]
      
      # Class-specific augmentation (for minority classes)
      class_balanced: false
      minority_class_boost: 1.5  # Extra augmentation for minority classes


# Logging and validation (unchanged)
logging:
  log_dir: "logs"
  log_interval: 10
  memory_logging: true
  save_freq: 10
  save_best_only: false

validation:
  compute_class_metrics: true
  save_predictions: true
  plot_curves: true